# Node.js

Node.js 는 크롬 v8 JS엔진으로 만들어진 javascript 실행환경이다. 싱글 스레드로 여러 작업을 동시에 처리하기 위해 논 블로킹, 이벤트 루프를 활용한다.

## 특성

* Non-Blocking(비동기)

블로킹 - 다른 JS 작업이 있을 때, 이전 작업의 I/O 작업들이 마무리 될 때까지 실행하지 못하고 막혀(block) 있는것이다

논 블로킹은 JavaScript가 아닌 작업을 기다리지 않는다. I/O 같은 다른 작업은 시스템 커널에 넘긴 뒤 콜백으로 올 때 처리한다. 기다리지 않고 추가 Javascript 작업을 실행하기 때문에 더 많은 작업을 빠르게 처리할 수 있다.

* Event Loop

이벤트 루프는 Node.js 가 싱글 스레드로 여러 작업을 동시처리 하기위한 구조이다. 시스템 커널에 여러 작업을 떠맡겨서 node 자체는 계속 돌아갈 수 있다. poll 단계에서 새로운 입출력 작업을 추가하고, 각 단계를 돌며 단계 별 queue 에서 콜백을 실행 한다. 대기 작업이 없으면 종료한다.

```text
   ┌───────────────────────────┐
┌─>│           timers          │
│  └─────────────┬─────────────┘
│  ┌─────────────┴─────────────┐
│  │     pending callbacks     │
│  └─────────────┬─────────────┘
│  ┌─────────────┴─────────────┐
│  │       idle, prepare       │
│  └─────────────┬─────────────┘      ┌───────────────┐
│  ┌─────────────┴─────────────┐      │   incoming:   │
│  │           poll            │<─────┤  connections, │
│  └─────────────┬─────────────┘      │   data, etc.  │
│  ┌─────────────┴─────────────┐      └───────────────┘
│  │           check           │
│  └─────────────┬─────────────┘
│  ┌─────────────┴─────────────┐
└──┤      close callbacks      │
   └───────────────────────────┘
```

1. timers : setTimeout() / setInterval() 콜백 실행
2. pending callbacks : 연기된 I/O 콜백
3. idle, prepare : 내부용 콜백
4. poll : 새 I/O 이벤트 가져옴, I/O 콜백 대부분 수행.
5. check : setImmediate() 콜백
6. close callbacks : 일부 close 콜백
